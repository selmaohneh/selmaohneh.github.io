<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Tasmota on Cello&#39;s Blog</title>
        <link>http://localhost:1313/tags/tasmota/</link>
        <description>Recent content in Tasmota on Cello&#39;s Blog</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Wed, 04 Sep 2024 00:00:00 +0000</lastBuildDate><atom:link href="http://localhost:1313/tags/tasmota/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>Fixing Connection Issues by Flashing ESPHome on Shellys OTA</title>
        <link>http://localhost:1313/post/fixing-connection-issues-by-flashing-esphome-on-shellys-ota/</link>
        <pubDate>Wed, 04 Sep 2024 00:00:00 +0000</pubDate>
        
        <guid>http://localhost:1313/post/fixing-connection-issues-by-flashing-esphome-on-shellys-ota/</guid>
        <description>&lt;img src="http://localhost:1313/post/fixing-connection-issues-by-flashing-esphome-on-shellys-ota/cover.jpg" alt="Featured image of post Fixing Connection Issues by Flashing ESPHome on Shellys OTA" /&gt;&lt;h2 id=&#34;the-problem&#34;&gt;The Problem
&lt;/h2&gt;&lt;p&gt;My house is flooded with smart relays from Shelly.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I use multiple &lt;a class=&#34;link&#34; href=&#34;https://amzn.to/3LJYm2f&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Shelly 2.5&lt;/a&gt; to control all the covers in my house&lt;/li&gt;
&lt;li&gt;I use a &lt;a class=&#34;link&#34; href=&#34;https://amzn.to/3LKJiSg&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Shelly 1PM&lt;/a&gt; to keep track of the production of my &lt;a class=&#34;link&#34; href=&#34;https://amzn.to/4cQXyV1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;balcony power plant&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;I use many &lt;a class=&#34;link&#34; href=&#34;https://amzn.to/4e69Rhd&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Shelly 1&lt;/a&gt; to automate my light switches&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I have at least 30 smart relays around my house/garden and they work flawlessly!
But then there are one or two relays that give me headaches. Especially the one controlling the lights at my stairs. These lights are motion-controlled and I expect them to go off 3 minutes after all motion cleared. But over the last couple of weeks, this has not been happening.. This is very annoying since I had to get out of bed and switch them off manually.&lt;/p&gt;
&lt;p&gt;So I checked the Home Assistant logs regularly to find the root cause. But all I found was the generic error &lt;code&gt;DeviceConnectionError()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Then I stumbled on something interesting in the &lt;a class=&#34;link&#34; href=&#34;https://esphome.io/components/api.html&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;ESPHome docs&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/post/fixing-connection-issues-by-flashing-esphome-on-shellys-ota/esphome-vs-mqtt.jpg&#34;
	width=&#34;697&#34;
	height=&#34;481&#34;
	srcset=&#34;http://localhost:1313/post/fixing-connection-issues-by-flashing-esphome-on-shellys-ota/esphome-vs-mqtt_hu4823773629946252659.jpg 480w, http://localhost:1313/post/fixing-connection-issues-by-flashing-esphome-on-shellys-ota/esphome-vs-mqtt_hu15501111899955496945.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;ESPHome vs. MQTT&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;144&#34;
		data-flex-basis=&#34;347px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;That’s why I decided to give ESPHome a try and looked for a way to flash ESPHome onto my Shelly. Maybe this might finally fix the connection errors! Let’s get going!&lt;/p&gt;
&lt;h2 id=&#34;creating-the-esphome-firmware&#34;&gt;Creating the ESPHome firmware
&lt;/h2&gt;&lt;p&gt;Go to ESPHome and add a new device. We do &lt;strong&gt;not&lt;/strong&gt; need to connect our Shelly to the computer since we can do everything &lt;em&gt;OTA&lt;/em&gt; (over-the-air).&lt;/p&gt;
&lt;p&gt;Click on edit and insert and tweak the following configuration to fit your needs:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Basic Config&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;esphome&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;stairs_light_shelly&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;platform&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;ESP8266&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;board&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;esp01_1m&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;wifi&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;ssid&lt;/span&gt;: !&lt;span style=&#34;color:#ae81ff&#34;&gt;secret wifi_ssid&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;password&lt;/span&gt;: !&lt;span style=&#34;color:#ae81ff&#34;&gt;secret wifi_password&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;logger&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;api&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;ota&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#75715e&#34;&gt;# Device Specific Config&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;output&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - &lt;span style=&#34;color:#f92672&#34;&gt;platform&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;gpio&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;pin&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;GPIO4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;id&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;relayid&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;light&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - &lt;span style=&#34;color:#f92672&#34;&gt;platform&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;binary&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;stairs_light&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;output&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;relayid&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;id&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;lightid&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;binary_sensor&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  - &lt;span style=&#34;color:#f92672&#34;&gt;platform&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;gpio&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;pin&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;number&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;GPIO5&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;name&lt;/span&gt;: &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;stairs_light_button&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;id&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;switchid&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Hit save, click the 3 dots and select install. Choose &lt;em&gt;Manual download&lt;/em&gt; and download the firmware file in &lt;em&gt;modern format&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/post/fixing-connection-issues-by-flashing-esphome-on-shellys-ota/ota.jpg&#34;
	width=&#34;551&#34;
	height=&#34;423&#34;
	srcset=&#34;http://localhost:1313/post/fixing-connection-issues-by-flashing-esphome-on-shellys-ota/ota_hu3920761496051872125.jpg 480w, http://localhost:1313/post/fixing-connection-issues-by-flashing-esphome-on-shellys-ota/ota_hu3480764484358454470.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;The wireless option for flashing the firmware&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;130&#34;
		data-flex-basis=&#34;312px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;After the file was created and downloaded, we have to zip it since the file would be too big to upload it onto the Shelly 1. I use &lt;a class=&#34;link&#34; href=&#34;https://www.7-zip.org/&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;7-Zip&lt;/a&gt; for that. Simply right-click the file and compress it to &lt;strong&gt;gzip&lt;/strong&gt;!&lt;/p&gt;
&lt;p&gt;You should now have a Shelly 1 ESPHome firmware with extension &lt;code&gt;.bin.gz&lt;/code&gt; on your drive.&lt;/p&gt;
&lt;h2 id=&#34;flashing-tasmota-as-intermediate-firmware&#34;&gt;Flashing Tasmota as intermediate firmware
&lt;/h2&gt;&lt;p&gt;Check which IP is assigned to the Shelly you want to flash. You can see this in your &lt;a class=&#34;link&#34; href=&#34;https://amzn.to/3NNV40z&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;router&lt;/a&gt; or by clicking &lt;em&gt;Visit&lt;/em&gt; from inside Home Assistant.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/post/fixing-connection-issues-by-flashing-esphome-on-shellys-ota/visit.jpg&#34;
	width=&#34;366&#34;
	height=&#34;332&#34;
	srcset=&#34;http://localhost:1313/post/fixing-connection-issues-by-flashing-esphome-on-shellys-ota/visit_hu5054928018808083197.jpg 480w, http://localhost:1313/post/fixing-connection-issues-by-flashing-esphome-on-shellys-ota/visit_hu10893991699551805014.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;Link to the device&amp;rsquo;s IP in Home Assistant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;110&#34;
		data-flex-basis=&#34;264px&#34;
	
&gt;&lt;/p&gt;
&lt;p&gt;Check the table in &lt;a class=&#34;link&#34; href=&#34;https://github.com/alexdelprete/mgos-to-tasmota&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;this repository&lt;/a&gt;. In case of a Shelly 1 you’d have to enter the following URL into the browser:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;http://YOURIPADDRESS/ota?url=http://ota.tasmota.com/tasmota/shelly/mg2tasmota-Shelly1.zip
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;This will flash Tasmota onto your Shelly.&lt;/p&gt;
&lt;p&gt;After 2 minutes you should see a new WiFi network with a name like &lt;code&gt;tasmota-XXXXX&lt;/code&gt;. Connect to it and head over to &lt;a class=&#34;link&#34; href=&#34;http://192.168.4.1&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;http://192.168.4.1&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Here you can enter your WiFi credentials and hit save. Tasmota will now connect to your WiFi.&lt;/p&gt;
&lt;h2 id=&#34;flashing-our-esphome-firmware&#34;&gt;Flashing our ESPHome firmware
&lt;/h2&gt;&lt;p&gt;Go back to the IP address of your Shelly. You should see the default page of Tasmota.&lt;/p&gt;
&lt;p&gt;Now it’s important to click on Console and enter&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;SetOption78 1
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;The console should confirm that you enabled the option 78. This enables us to flash firmware files that are not Tasmota builds.&lt;/p&gt;
&lt;p&gt;Now head back to the main menu, select &lt;em&gt;Firmware Upgrade&lt;/em&gt; and upload the firmware file we created previously. Start the upgrade! If everything worked out you should get a success message.&lt;/p&gt;
&lt;h2 id=&#34;integration-into-home-assistant&#34;&gt;Integration into Home Assistant
&lt;/h2&gt;&lt;p&gt;After a short time (or a forced restart of Home Assistant), you will receive a notification that a new ESPHome device has been discovered — automatically!&lt;/p&gt;
&lt;p&gt;That was easy.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;http://localhost:1313/post/fixing-connection-issues-by-flashing-esphome-on-shellys-ota/stairs-in-hass.jpg&#34;
	width=&#34;1064&#34;
	height=&#34;839&#34;
	srcset=&#34;http://localhost:1313/post/fixing-connection-issues-by-flashing-esphome-on-shellys-ota/stairs-in-hass_hu10169789864914084357.jpg 480w, http://localhost:1313/post/fixing-connection-issues-by-flashing-esphome-on-shellys-ota/stairs-in-hass_hu9288250018621894244.jpg 1024w&#34;
	loading=&#34;lazy&#34;
	
		alt=&#34;The stairs as device in Home Assistant&#34;
	
	
		class=&#34;gallery-image&#34; 
		data-flex-grow=&#34;126&#34;
		data-flex-basis=&#34;304px&#34;
	
&gt;&lt;/p&gt;
&lt;h2 id=&#34;summary&#34;&gt;Summary
&lt;/h2&gt;&lt;p&gt;It is possible to flash ESPHome onto many kinds of &lt;a class=&#34;link&#34; href=&#34;https://amzn.to/4dQAKG4&#34;  target=&#34;_blank&#34; rel=&#34;noopener&#34;
    &gt;Shelly smart relays&lt;/a&gt; simply over-the-air. For me this fixed the connection issues I had with a specific Shelly 1.&lt;/p&gt;
&lt;p&gt;This tutorial might help you if you are trying to solve the same problem!&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>

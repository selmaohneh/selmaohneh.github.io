<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Imperfection\rOne important lesson I learned working as a software engineer in the production industry for many years:\nSome things don’t work on the first try.\nThe real-world hardware and corresponding drivers I met and worked with always had some quirks.\nSome hardware disconnects from time to time. Some drivers throw an exception when commands are executed too fast after each other. Some sensors don’t answer your commands at all. Maybe after the third try. The world is not perfect and everyone makes mistakes. Most of the time, hardware and drivers don’t work as you would expect.\n">
<meta name="keywords" content="retry, polly, api, dry, clean code, pattern"><title>How to implement Retries without Cluttering your Code</title>

<link rel='canonical' href='http://localhost:1313/post/how-to-implement-retries-without-cluttering-your-code/'>

<link rel="stylesheet" href="/scss/style.min.8cfce3f7f4becf7211ba030d1db4213c21bda2513246348c6bf5f6ffb00738f8.css"><meta property='og:title' content="How to implement Retries without Cluttering your Code">
<meta property='og:description' content="Imperfection\rOne important lesson I learned working as a software engineer in the production industry for many years:\nSome things don’t work on the first try.\nThe real-world hardware and corresponding drivers I met and worked with always had some quirks.\nSome hardware disconnects from time to time. Some drivers throw an exception when commands are executed too fast after each other. Some sensors don’t answer your commands at all. Maybe after the third try. The world is not perfect and everyone makes mistakes. Most of the time, hardware and drivers don’t work as you would expect.\n">
<meta property='og:url' content='http://localhost:1313/post/how-to-implement-retries-without-cluttering-your-code/'>
<meta property='og:site_name' content='Cello&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='retry' /><meta property='article:tag' content='polly' /><meta property='article:tag' content='api' /><meta property='article:tag' content='dry' /><meta property='article:tag' content='clean code' /><meta property='article:tag' content='pattern' /><meta property='article:published_time' content='2024-07-24T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2024-07-24T00:00:00&#43;00:00'/><meta property='og:image' content='http://localhost:1313/post/how-to-implement-retries-without-cluttering-your-code/cover.jpg' />
<meta name="twitter:title" content="How to implement Retries without Cluttering your Code">
<meta name="twitter:description" content="Imperfection\rOne important lesson I learned working as a software engineer in the production industry for many years:\nSome things don’t work on the first try.\nThe real-world hardware and corresponding drivers I met and worked with always had some quirks.\nSome hardware disconnects from time to time. Some drivers throw an exception when commands are executed too fast after each other. Some sensors don’t answer your commands at all. Maybe after the third try. The world is not perfect and everyone makes mistakes. Most of the time, hardware and drivers don’t work as you would expect.\n"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='http://localhost:1313/post/how-to-implement-retries-without-cluttering-your-code/cover.jpg' />
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-1JTF1W963D"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-1JTF1W963D');
        }
      </script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "auto");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/me_hu17223136899916894782.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Cello&#39;s Blog</a></h1>
            <h2 class="site-description">Software Craftmanship, Smart Home, and Nerdy Stuff.</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://bsky.app/profile/selmaohneh.bsky.social'
                        target="_blank"
                        title="Bluesky"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bluesky"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6.335 5.144c-1.654 -1.199 -4.335 -2.127 -4.335 .826c0 .59 .35 4.953 .556 5.661c.713 2.463 3.13 2.75 5.444 2.369c-4.045 .665 -4.889 3.208 -2.667 5.41c1.03 1.018 1.913 1.59 2.667 1.59c2 0 3.134 -2.769 3.5 -3.5c.333 -.667 .5 -1.167 .5 -1.5c0 .333 .167 .833 .5 1.5c.366 .731 1.5 3.5 3.5 3.5c.754 0 1.637 -.571 2.667 -1.59c2.222 -2.203 1.378 -4.746 -2.667 -5.41c2.314 .38 4.73 .094 5.444 -2.369c.206 -.708 .556 -5.072 .556 -5.661c0 -2.953 -2.68 -2.025 -4.335 -.826c-2.293 1.662 -4.76 5.048 -5.665 6.856c-.905 -1.808 -3.372 -5.194 -5.665 -6.856z" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='mailto:info@cellos.blog'
                        target="_blank"
                        title="Email"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-mail"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10z" /><path d="M3 7l9 6l9 -6" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/selmaohneh'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.linkedin.com/in/marcel-neumann-8b62b02bb/'
                        target="_blank"
                        title="LinkedIn"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-linkedin"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z" /><path d="M8 11l0 5" /><path d="M8 8l0 .01" /><path d="M12 16l0 -5" /><path d="M16 16v-3a2 2 0 0 0 -4 0" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://mastodon.social/@selmaohneh'
                        target="_blank"
                        title="Mastodon"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-mastodon"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M18.648 15.254c-1.816 1.763 -6.648 1.626 -6.648 1.626a18.262 18.262 0 0 1 -3.288 -.256c1.127 1.985 4.12 2.81 8.982 2.475c-1.945 2.013 -13.598 5.257 -13.668 -7.636l-.026 -1.154c0 -3.036 .023 -4.115 1.352 -5.633c1.671 -1.91 6.648 -1.666 6.648 -1.666s4.977 -.243 6.648 1.667c1.329 1.518 1.352 2.597 1.352 5.633s-.456 4.074 -1.352 4.944z" /><path d="M12 11.204v-2.926c0 -1.258 -.895 -2.278 -2 -2.278s-2 1.02 -2 2.278v4.722m4 -4.722c0 -1.258 .895 -2.278 2 -2.278s2 1.02 2 2.278v4.722" /></svg>
                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://cellos.blog/index.xml'
                        target="_blank"
                        title="RSS"
                        rel="me"
                    >
                        
                        
                            <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-rss"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" /><path d="M4 4a16 16 0 0 1 16 16" /><path d="M4 11a9 9 0 0 1 9 9" /></svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/page/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#imperfection">Imperfection</a></li>
    <li><a href="#a-naive-solution">A naive Solution</a></li>
    <li><a href="#the-extraction">The Extraction</a></li>
    <li><a href="#party-parrot-to-the-rescue">Party Parrot to the rescue!</a></li>
    <li><a href="#the-advantages">The Advantages</a></li>
  </ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/post/how-to-implement-retries-without-cluttering-your-code/">
                <img src="/post/how-to-implement-retries-without-cluttering-your-code/cover_hu3963337231000010328.jpg"
                        srcset="/post/how-to-implement-retries-without-cluttering-your-code/cover_hu3963337231000010328.jpg 800w, /post/how-to-implement-retries-without-cluttering-your-code/cover_hu1267169917689747279.jpg 1600w"
                        width="800" 
                        height="600" 
                        loading="lazy"
                        alt="Featured image of post How to implement Retries without Cluttering your Code" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/software-craftmanship/" >
                Software Craftmanship
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/post/how-to-implement-retries-without-cluttering-your-code/">How to implement Retries without Cluttering your Code</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2024-07-24</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    4 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="imperfection">Imperfection
</h2><p>One important lesson I learned working as a software engineer in the production industry for many years:</p>
<blockquote>
<p>Some things don’t work on the first try.</p>
</blockquote>
<p>The real-world hardware and corresponding drivers I met and worked with always had some quirks.</p>
<ul>
<li>Some hardware disconnects from time to time.</li>
<li>Some drivers throw an exception when commands are executed too fast after each other.</li>
<li>Some sensors don’t answer your commands at all. Maybe after the third try.</li>
</ul>
<blockquote>
<p>The world is not perfect and everyone makes mistakes. Most of the time, hardware and drivers don’t work as you would expect.</p>
</blockquote>
<h2 id="a-naive-solution">A naive Solution
</h2><p>A common solution to avoid these irregular effects, if you cannot fix the root cause, is introducing a retry logic for your action. This often looks similar to the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">int</span> maxAmountOfTries = <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> currentAmountOfTries = <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> (<span style="color:#66d9ef">true</span>)
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (currentAmountOfTries &gt; maxAmountOfTries)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        currentAmountOfTries++;
</span></span><span style="display:flex;"><span>        DoSomethingThatCanThrowAnException();
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">catch</span> (Exception)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ignore or log exception</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This is a great piece of code! It is easy to read, and everyone glimpsing at it knows that this is some retry logic immediately. They could even tweak the number of allowed retries without any deep dive into the code — it’s maintainable, too!</p>
<p>But as the code base grows, you will find that construct all over the solution. Even worse: always a little different.</p>
<ul>
<li>Most of the time, the variable names differ</li>
<li>Sometimes the maximum number of tries is set, and sometimes, the maximum number of retries is set.</li>
<li>Some classes retry on exceptions, some on specific results, some on both.</li>
</ul>
<p>These repetitions lead to confusion, which results in bugs.</p>
<blockquote>
<p>Don’t repeat yourself!</p>
</blockquote>
<h2 id="the-extraction">The Extraction
</h2><p>A smart team, of course, notices this flaw and tries to eliminate it. Let’s extract that retry logic so it can be reused! I saw several solutions for that over the years:</p>
<ul>
<li>A dedicated service for retrying like <code>IRetryService.Retry(...)</code></li>
<li>An extension method on <code>Action</code> or <code>Func</code></li>
</ul>
<p>These solutions worked most of the time. But they required a significant amount of work! Especially if you want to support retries for both sync and async actions. Still, nearly every bigger project contains some functionality like this.</p>
<h2 id="party-parrot-to-the-rescue">Party Parrot to the rescue!
</h2><p>There is already an elegant solution to this problem out there! You can use the library <a class="link" href="https://github.com/App-vNext/Polly"  target="_blank" rel="noopener"
    >Polly</a> to de-clutter your code. The icon of this library is a colorful parrot. That’s why I can’t resist making bad <a class="link" href="https://cultofthepartyparrot.com/"  target="_blank" rel="noopener"
    >Party Parrot</a> jokes about it — Party or Die!</p>
<blockquote>
<p>Don’t reinvent the wheel!</p>
</blockquote>
<p>Here is what the upper code looks like when Polly comes into place:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>RetryPolicy policy = Policy
</span></span><span style="display:flex;"><span>                  .Handle&lt;Exception&gt;()
</span></span><span style="display:flex;"><span>                  .Retry(<span style="color:#ae81ff">3</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>policy.Execute(DoSomethingThatCanThrowAnException);
</span></span></code></pre></div><p>Far less code. In this example, just five lines of code. And it is still clear and precise. That’s a great benefit we have already achieved!</p>
<p>It gets better. You remember how I said that hardware behaves strangely from time to time? I once met a sensor that returned <code>double.NaN</code> sometimes. If it did, you just had to let it rest for some seconds and schedule a retry.</p>
<p>Polly can do that, as well. Here is how I would additionally handle the invalid result and introduce a waiting time between every retry:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>RetryPolicy&lt;<span style="color:#66d9ef">double</span>&gt; policy = Policy&lt;<span style="color:#66d9ef">double</span>&gt;
</span></span><span style="display:flex;"><span>                              .Handle&lt;Exception&gt;()
</span></span><span style="display:flex;"><span>                              .OrResult(Double.NaN)
</span></span><span style="display:flex;"><span>                              .WaitAndRetry(<span style="color:#ae81ff">3</span>, (_, _) =&gt; TimeSpan.FromSeconds(<span style="color:#ae81ff">5</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>policy.Execute(DoSomethingThatCanThrowAnException);
</span></span></code></pre></div><h2 id="the-advantages">The Advantages
</h2><p>Let’s focus on the advantages of using Polly for retries:</p>
<ul>
<li>Great API: Short, precise, and easy to read.</li>
<li>Polly is widely used and tested. Don’t reinvent a buggy solution.</li>
<li>You can reuse common policies by sharing them between classes.</li>
</ul>
<p>I want to emphasize the API once more. Consider the following method: <code>public double DoSomethingCool(CancellationToken token).</code> I love that it takes a <code>CancellationToken</code>.</p>
<p>Why? Because any user of this method, every client, knows that it supports cancellation! And even better: Every user of this method can decide how they want to handle cancellation. They can cancel with a timeout, cancel when the user clicks some abort button, or cancel however they want.</p>
<blockquote>
<p>A great API forces the user to use it correctly.</p>
</blockquote>
<p>We can use the same idea for our retry logic with Polly. Look at the following updated method prototype: <code>public double DoSomethingCool(ISyncPolicy policy, CancellationToken token)</code> .</p>
<p>I love it! This method seems to support cancellation and execution policies — I know that just by looking at the prototype.</p>
<p>I can call it in any way I choose! Maybe with five retries on exceptions? Maybe with three retries on <code>double.NaN</code> with a timeout of two seconds max? It’s up to your clients — your method supports it no matter what they decide. Thanks to Polly and the great API design!</p>
<p>Definitely check out the <a class="link" href="https://github.com/App-vNext/Polly"  target="_blank" rel="noopener"
    >readme</a> of Polly because it can do so much more:</p>
<ul>
<li>rate-limiting</li>
<li>timeouts</li>
<li>caching</li>
</ul>
<p>Thanks for reading!</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/retry/">Retry</a>
        
            <a href="/tags/polly/">Polly</a>
        
            <a href="/tags/api/">Api</a>
        
            <a href="/tags/dry/">Dry</a>
        
            <a href="/tags/clean-code/">Clean Code</a>
        
            <a href="/tags/pattern/">Pattern</a>
        
    </section>


    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/post/how-and-where-to-handle-exceptions-while-maintaining-a-great-api/">
        
        
            <div class="article-image">
                <img src="/post/how-and-where-to-handle-exceptions-while-maintaining-a-great-api/cover.bf926c20a1828139374b6d8119d6b026_hu11270610461007121940.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post How and Where to handle Exceptions while Maintaining a Great API"
                        
                        data-hash="md5-v5JsIKGCgTk3S22BGdawJg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">How and Where to handle Exceptions while Maintaining a Great API</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/post/beyond-the-dogma-an-unpopular-opinion-on-clean-code/">
        
        
            <div class="article-image">
                <img src="/post/beyond-the-dogma-an-unpopular-opinion-on-clean-code/cover.720c274ef0478640e40a92a98de33414_hu13474124342763317123.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Beyond the Dogma: An unpopular opinion on Clean Code"
                        
                        data-hash="md5-cgwnTvBHhkDkCpKpjeM0FA==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Beyond the Dogma: An unpopular opinion on Clean Code</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2024 Cello&#39;s Blog
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
